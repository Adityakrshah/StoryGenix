import { useState } from "react";
import axios from "axios";
import { marked } from "marked";
import StarBackground from "./components/Background/StarBackground";

export default function App() {
  const [prompt, setPrompt] = useState("");
  const [language, setLanguage] = useState("English");
  const [mood, setMood] = useState("Emotional");
  const [loading, setLoading] = useState(false);
  const [script, setScript] = useState("");

  const normalizedLanguage =
  language.toLowerCase().replace(/^\w/, (c) => c.toUpperCase());

const generateScript = async () => {
  if (!prompt.trim()) return alert("Enter a prompt");

  setLoading(true);
  setScript("");

  try {
    const res = await axios.post(
      `${import.meta.env.VITE_API_URL}/api/generate-script`,
      {
        prompt: `${prompt}. Mood: ${mood}`,
        language,
      }
    );

    setScript(res.data.script);
  } catch (err) {
    console.error(err);
    alert("Failed to generate script");
  }

  setLoading(false);
};


  return (
    <div className="min-h-screen text-white flex flex-col relative overflow-hidden backdrop-blur-sm bg-black/40 rounded-xl
">
      <StarBackground />

      

      {/* Navbar */}
      <header className="h-14 flex items-center justify-between px-6 border-b border-neutral-800">
        <h1 className="font-bold tracking-wide">ðŸŽ¬ StoryGenix</h1>

        <div className="relative group">
          <div className="w-8 h-8 rounded-full bg-neutral-700 flex items-center justify-center cursor-pointer">
            ðŸ‘¤
          </div>

          {/* Profile Dropdown */}
          <div className="absolute right-0 mt-2 w-40 bg-neutral-900 border border-neutral-700 rounded-lg hidden group-hover:block">
            {["Profile", "History", "About", "Logout"].map(item => (
              <div
                key={item}
                className="px-4 py-2 hover:bg-neutral-800 cursor-pointer text-sm"
              >
                {item}
              </div>
            ))}
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="flex-1 flex flex-col items-center justify-center px-4">

        {/* Prompt Box */}
        <textarea
          placeholder="Write your prompt here..."
          className="w-full max-w-3xl h-40 p-4 bg-neutral-900 border border-neutral-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"
          value={prompt}
          onChange={(e) => setPrompt(e.target.value)}
        />

        {/* Controls */}
        <div className="flex flex-col sm:flex-row gap-4 mt-4 w-full max-w-3xl">

  <select
    className="bg-neutral-900 border border-neutral-700 px-4 py-2 rounded-lg w-full sm:w-auto"
    value={mood}
    onChange={(e) => setMood(e.target.value)}
  >
    <option>Emotional</option>
    <option>Action</option>
    <option>Horror</option>
    <option>Fantasy</option>
    <option>Sci-Fi</option>
    <option>Comedy</option>
  </select>

  <input
    type="text"
    placeholder="Language"
    className="bg-neutral-900 border border-neutral-700 px-4 py-2 rounded-lg w-full sm:w-56"
    value={language}
    onChange={(e) => setLanguage(e.target.value)}
  />

  <button
    onClick={generateScript}
    className="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-semibold w-full sm:w-auto"
  >
    {loading ? "Generating..." : "Generate"}
  </button>

</div>


        {/* Output */}
        {script && (
     <div
            className="mt-8 max-w-3xl w-full bg-neutral-900 p-6 rounded-xl border border-neutral-700 whitespace-pre-wrap"
            dangerouslySetInnerHTML={{
              __html: marked(script),
            }}
          />
        )}

      </main>

      {/* Footer */}
      <footer className="border-t border-neutral-800 text-sm text-neutral-500">
  <div className="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row gap-6 md:items-center md:justify-between text-center md:text-left">


    {/* Left */}
    <div className="text-xs text-neutral-600">
      StoryGenix
      <p>A space where imagination takes shape.</p>
    </div>

    {/* Center */}
    <div className="text-center">
      <p className="font-medium text-neutral-400">Â© 2025 StoryGenix. All rights reserved.</p>
      <div className="mt-2 text-xs leading-relaxed">
        <p></p>
      </div>
    </div>

    {/* Right */}
    <div className="flex gap-4 text-xs text-neutral-600">
      <span className="cursor-pointer hover:text-neutral-300">About</span>
      <span className="cursor-pointer hover:text-neutral-300">Contact</span>
    </div>

  </div>
</footer>


    </div>
  );
}